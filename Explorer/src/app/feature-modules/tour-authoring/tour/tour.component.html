<div class="wrapper">
  <div class="card-wrapper">
    <div class="card-wrapperB">
      <button class="card-wrapper-btn" (click)="addTour()">Add tour</button>
      <div class="vertical-line"></div>
      <label class="author-label" *ngIf="hasCoupon(-1)">Author coupon</label>
      <button class="card-wrapper-btn" (click)="onCreateAuthorCoupon()" *ngIf="!hasCoupon(-1)">Create author coupon</button>
      <mat-card class="author-coupon"  *ngIf="hasCoupon(-1)">

          <div class="author-coupon-info" *ngIf="!isEditing(-1)">
            <label font-weight="bold">Code: <b>{{ getCoupon(-1)?.code }}</b></label>
            <label>Discount: <b>{{ getCoupon(-1)?.discount }}%</b></label>
            <label>Expires: <b>{{ getCoupon(-1)?.expirationDate | date: 'dd MMM yyyy' }}</b></label>
            <!-- Add more coupon details as needed -->        
          </div>
          <div class="author-coupon-buttons" *ngIf="!isEditing(-1)">
            <button matTooltip="Edit coupon" mat-icon-button color="primary" (click)="startEditing(-1)">
              <mat-icon>edit-button</mat-icon>
            </button>
            <button matTooltip="Delete coupon" mat-icon-button color="warn" (click)="deleteCoupon(-1)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

      
        <div class="author-coupon-edit" *ngIf="isEditing(-1)">
          <!-- Use ngModel to bind the input to a variable in your component -->
          <div class="author-form" [formGroup]="editForm">
            
              <mat-form-field class="author-inputs">
                <input matInput formControlName="discount" placeholder="Discount (%)" type="number" min="1" max="100">
              </mat-form-field> 
            
            
            
              <mat-form-field class="author-inputs"> 
                <input matInput [matDatepicker]="picker" formControlName="expirationDate" placeholder="Expiration Date">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
           
          </div>
      
          <div class="edit-actions">
            <button mat-button color="primary" class="action-button" (click)="saveEdit(-1)">Save</button>
            <button mat-button color="warn" class="action-button" (click)="cancelEdit(-1)">Cancel</button>
          </div>
        </div>
      </mat-card> 
    </div>
    <div class="tours">
      <div *ngFor="let t of tour" class="card">
        <mat-card>
          <mat-card-header>
            <div class="headerName">
              <div class="title">
                <mat-card-title>{{ t.name }}</mat-card-title>
                <div class="buttons">
                  <button
                    (click)="deleteTour(t)"
                    color="accent"
                    mat-icon-button
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
              <div class="status">
                <mat-card-subtitle>{{ t.status }}</mat-card-subtitle>
              </div>
            </div>
          </mat-card-header>

          <div class="maindiv">
            <mat-card-content>
              <div class="content">
                <p class="details">üõà Details</p>

                <p class="desc">{{ t.description }}</p>
              </div>
              <div class="other">
                <div>
                  <p class="price-value">{{ t.price }}$</p>

                  <div class="difLevel">
                    <mat-card-subtitle
                      [ngClass]="{
                        easy: t.difficultyLevel === 'Easy',
                        medium: t.difficultyLevel === 'Moderate',
                        hard: t.difficultyLevel === 'Difficult'
                      }"
                    >
                      {{ t.difficultyLevel }}
                    </mat-card-subtitle>
                  </div>
                </div>

                <button
                  *ngIf="t.id !== undefined"
                  mat-button
                  (click)="viewMap(t.id)"
                >
                  üó∫Ô∏è
                </button>
              </div>
            </mat-card-content>
          </div>
          <mat-card-actions>
            <div class="definition">
              <div class="buttons">
                <button
                  class="equipment"
                  mat-button
                  (click)="openEquipmentDialog(t)"
                >
                  Add equipment
                </button>
                <button (click)="onAddPoint(t)" color="primary" mat-icon-button>
                  <mat-icon>add</mat-icon>
                </button>

                <button (click)="onAddObj(t)" color="primary" mat-icon-button>
                  <mat-icon>restaurant</mat-icon>
                </button>
              </div>
              <div class="isPublished">
                <button
                  *ngIf="t.status === 'Published'"
                  mat-button
                  color="white"
                  (click)="archiveTour(t)"
                >
                  Archive
                </button>
                <button
                  *ngIf="t.status !== 'Published'"
                  mat-button
                  color="white"
                  (click)="publishTour(t)"
                >
                  Publish
                </button>
              </div>
            </div>
          </mat-card-actions>
          <div class="coupon-details" *ngIf="hasCoupon(t.id)">
            <div class="coupon-info" *ngIf="!isEditing(t.id)">
              <label font-weight="bold">Code: <b>{{ getCoupon(t.id)?.code }}</b></label>
              <label>Discount: <b>{{ getCoupon(t.id)?.discount }}%</b></label>
              <label>Expires: <b>{{ getCoupon(t.id)?.expirationDate | date: 'dd MMM yyyy' }}</b></label>
              <!-- Add more coupon details as needed -->        
              
              <div class="coupon-buttons">
                <button matTooltip="Edit coupon" mat-icon-button color="primary" (click)="startEditing(t.id)">
                  <mat-icon>edit-button</mat-icon>
                </button>
                <button matTooltip="Delete coupon" mat-icon-button color="warn" (click)="deleteCoupon(t.id)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          
            <div *ngIf="isEditing(t.id)">
              <!-- Use ngModel to bind the input to a variable in your component -->
              <div [formGroup]="editForm" class="mat-form-row">
                
                  <mat-form-field class="discount-field">
                    <input matInput formControlName="discount" placeholder="Discount (%)" type="number" min="1" max="100">
                  </mat-form-field>
                
                
                
                  <mat-form-field class="expiration-field"> 
                    <input matInput [matDatepicker]="picker" formControlName="expirationDate" placeholder="Expiration Date">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
               
              </div>
          
              <div class="edit-actions">
                <button mat-button color="primary" class="action-button" (click)="saveEdit(t.id)">Save</button>
                <button mat-button color="warn" class="action-button" (click)="cancelEdit(t.id)">Cancel</button>
              </div>
            </div>
          </div>
          <div class="noCoupon" *ngIf="!hasCoupon(t.id)">
              <button class="create-coupon-btn" (click)="onCreateCoupon(t.id)">
                Create coupon
              </button>
          </div>
          
        </mat-card>
      </div>
    </div>
    <div *ngIf="shouldAddPoint">
      <p>Public tour points</p>
      <div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Longitude</th>
                <th>Latitude</th>
                <th>Add</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ptp of publicTourPointsForTour">
                <td>{{ ptp.name }}</td>
                <td>{{ ptp.description }}</td>
                <td>{{ ptp.longitude }}</td>
                <td>{{ ptp.latitude }}</td>
                <button
                  (click)="onAddPublicPoint(selectedTour, ptp)"
                  color="primary"
                  mat-icon-button
                >
                  <mat-icon>add</mat-icon>
                </button>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="wrapper-form">
      <xp-tour-point-form
        *ngIf="shouldAddPoint"
        [tour]="selectedTour"
        (closeTourPointForm)="onClose()"
      ></xp-tour-point-form>
      <xp-object-form
        *ngIf="shouldAddObject"
        [tour]="selectedTour"
        (closeForm)="onCloseObject()"
      ></xp-object-form>

      <xp-tour-form
        [tour]="selectedTour"
        *ngIf="showTourForm"
        (tourUpdated)="loadTours()"
        (addTourClicked)="onAddTourClicked()"
      ></xp-tour-form>
    </div>
  </div>
</div>
